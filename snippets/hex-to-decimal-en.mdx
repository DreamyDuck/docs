export const HexToDecimalConverter = () => {
  const [hexInput, setHexInput] = useState('')
  const [decimalResult, setDecimalResult] = useState(null)
  const [error, setError] = useState('')

  const validateAndConvert = (hex) => {
    // Remove any '#' prefix and whitespace
    const cleanHex = hex.replace(/^#/, '').trim()
    
    // Check if it's empty
    if (!cleanHex) {
      setDecimalResult(null)
      setError('')
      return
    }
    
    // Check if it's a valid hex string (only contains 0-9, a-f, A-F)
    const hexRegex = /^[0-9a-fA-F]+$/
    
    if (!hexRegex.test(cleanHex)) {
      setError('Invalid hex format. Use only 0-9 and A-F characters.')
      setDecimalResult(null)
      return
    }
    
    try {
      const decimal = parseInt(cleanHex, 16)
      setDecimalResult(decimal)
      setError('')
    } catch (err) {
      setError('Error converting hex to decimal.')
      setDecimalResult(null)
    }
  }

  const handleHexInputChange = (e) => {
    const value = e.target.value
    setHexInput(value)
    validateAndConvert(value)
  }

  const copyToClipboard = (value) => {
    navigator.clipboard
      .writeText(value.toString())
      .then(() => {
        console.log(`Copied ${value} to clipboard!`)
      })
      .catch((err) => {
        console.error("Failed to copy: ", err)
      })
  }

  const handleKeyDown = (e) => {
    if (e.key === 'Enter' && decimalResult !== null) {
      copyToClipboard(decimalResult)
    }
  }

  return (
    <div className="p-4 border dark:border-zinc-950/80 rounded-xl not-prose">
      <div className="space-y-4">
        <div className="space-y-2">
          <label className="block text-sm text-zinc-950/70 dark:text-white/70">
            Hex Value
            <input
              type="text"
              value={hexInput}
              onChange={handleHexInputChange}
              placeholder="Enter hex value (e.g., FF, #A1B2C3, 1A2B)"
              className="w-full p-3 mt-1 border border-zinc-950/20 dark:border-white/20 rounded-lg bg-white dark:bg-zinc-950 text-zinc-950 dark:text-white placeholder:text-zinc-950/50 dark:placeholder:text-white/50 focus:outline-none focus:ring-2 focus:ring-blue-500 font-mono"
              aria-label="Hexadecimal input"
            />
          </label>
        </div>

        {error && (
          <div className="text-sm text-red-500" role="alert" aria-live="polite">
            {error}
          </div>
        )}

        {decimalResult !== null && (
          <div 
            className="p-4 bg-zinc-950/5 dark:bg-white/5 rounded-lg cursor-pointer transition-transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500"
            title={`Click to copy: ${decimalResult}`}
            onClick={() => copyToClipboard(decimalResult)}
            onKeyDown={handleKeyDown}
            tabIndex={0}
            role="button"
            aria-label={`Decimal result: ${decimalResult}. Click or press Enter to copy.`}
          >
            <div className="text-sm text-zinc-950/70 dark:text-white/70 mb-1">
              Decimal Result:
            </div>
            <div className="text-3xl font-mono font-bold text-zinc-950 dark:text-white">
              {decimalResult.toLocaleString()}
            </div>
          </div>
        )}

        <div className="text-sm font-mono text-zinc-950/70 dark:text-white/70">
          <p>
            Enter a hexadecimal value to convert it to decimal. Click the result to copy to clipboard.
          </p>
        </div>
      </div>
    </div>
  )
}