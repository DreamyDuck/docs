export const HexToDecimalConverter = () => {
  const [hexInput, setHexInput] = useState('');
  const [decimalOutput, setDecimalOutput] = useState(null);
  const [error, setError] = useState(null);
  const [copiedMessage, setCopiedMessage] = useState(null);

  useEffect(() => {
    const trimmedHex = hexInput.trim();

    if (!trimmedHex) {
      setDecimalOutput(null);
      setError(null);
      return;
    }

    const hexRegex = /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/i;
    if (!hexRegex.test(trimmedHex)) {
      setError('Invalid hex format. Use #RGB or #RRGGBB.');
      setDecimalOutput(null);
      return;
    }

    setError(null); // Clear previous error

    let hexValue = trimmedHex.substring(1); // Remove #

    if (hexValue.length === 3) {
      hexValue = hexValue
        .split('')
        .map((char) => char + char)
        .join(''); // "RGB" -> "RRGGBB"
    }

    const r = parseInt(hexValue.substring(0, 2), 16);
    const g = parseInt(hexValue.substring(2, 4), 16);
    const b = parseInt(hexValue.substring(4, 6), 16);

    if (isNaN(r) || isNaN(g) || isNaN(b)) {
      setError('Error parsing hex components.'); // Should be caught by regex, but as a fallback
      setDecimalOutput(null);
    } else {
      setDecimalOutput({ r, g, b });
    }
  }, [hexInput]);

  const handleHexInputChange = (e) => {
    setHexInput(e.target.value);
    if (copiedMessage) setCopiedMessage(null); // Clear copied message on new input
  };

  const handleCopyToClipboard = (textToCopy) => {
    if (!navigator.clipboard) {
      setCopiedMessage('Clipboard API not available.');
      setTimeout(() => setCopiedMessage(null), 3000);
      return;
    }
    navigator.clipboard
      .writeText(textToCopy)
      .then(() => {
        setCopiedMessage(`Copied "${textToCopy}"!`);
      })
      .catch((err) => {
        setCopiedMessage('Failed to copy.');
        console.error('Failed to copy: ', err);
      });
    setTimeout(() => setCopiedMessage(null), 3000); // Clear message after 3s
  };

  return (
    <div className="p-4 border dark:border-zinc-950/80 rounded-xl not-prose">
      <h2 className="text-xl font-semibold mb-4 text-zinc-900 dark:text-white">
        Hex to Decimal Converter
      </h2>
      <div className="space-y-4">
        <div>
          <label
            htmlFor="hexInput"
            className="block text-sm font-medium text-zinc-950/70 dark:text-white/70 mb-1"
          >
            Enter Hex Color Code:
          </label>
          <input
            type="text"
            id="hexInput"
            value={hexInput}
            onChange={handleHexInputChange}
            placeholder="#RRGGBB or #RGB"
            className="mt-1 block w-full px-3 py-2 bg-white dark:bg-zinc-800 border border-zinc-300 dark:border-zinc-700 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 focus:border-green-500 sm:text-sm text-zinc-900 dark:text-white"
            aria-describedby={error ? "hexError" : undefined}
          />
        </div>

        {error && (
          <p id="hexError" className="text-sm text-red-600 dark:text-red-400">
            {error}
          </p>
        )}

        {decimalOutput && !error && (
          <div className="space-y-3 p-3 bg-zinc-50 dark:bg-zinc-800/50 rounded-md">
            <p className="text-md font-medium text-zinc-900 dark:text-white">
              Decimal Value:
              <span className="ml-2 font-mono px-2 py-1 bg-zinc-200 dark:bg-zinc-700 rounded text-sm">
                R: {decimalOutput.r}, G: {decimalOutput.g}, B: {decimalOutput.b}
              </span>
            </p>
            <div className="flex items-center space-x-3">
              <div
                className="w-10 h-10 rounded border border-zinc-300 dark:border-zinc-700"
                style={{
                  backgroundColor: hexInput.trim(),
                  transition: 'background-color 0.3s ease',
                }}
                title={`Color preview for ${hexInput.trim()}`}
                aria-label={`Color preview for ${hexInput.trim()}`}
              ></div>
              <button
                type="button"
                onClick={() =>
                  handleCopyToClipboard(
                    `rgb(${decimalOutput.r}, ${decimalOutput.g}, ${decimalOutput.b})`
                  )
                }
                className="px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-zinc-50 dark:focus:ring-offset-zinc-900 focus:ring-green-500 dark:bg-green-500 dark:hover:bg-green-600 transition-colors"
              >
                Copy RGB
              </button>
            </div>
          </div>
        )}
        {copiedMessage && (
          <p
            className="text-sm text-green-700 dark:text-green-500 mt-2"
            role="status"
            aria-live="polite"
          >
            {copiedMessage}
          </p>
        )}
      </div>
    </div>
  );
};